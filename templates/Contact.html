<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Me</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/stylesheet.css">
    <style>
        .captcha-container { margin: 1rem 0; position: relative; }
        #captchaImage { cursor: pointer; border: 1px solid #ddd; border-radius: 4px; }
        .refresh-captcha { position: absolute; right: 0; top: 50%; transform: translateY(-50%); }
        .hidden { display: none; }
        .privacy-disclaimer { font-size: 0.8em; color: #e7e7e7; }
        .invalid-feedback { display: none; }
        .is-invalid ~ .invalid-feedback { display: block; }
        .error-popup { color: red; font-size: 0.875em; margin-top: 5px; }
    </style>
</head>
<body class="p-3">
    
    {% include 'navbar.html' %}

    {% set form_data = form_data or {
        'name': '',
        'email': '',
        'subject': '',
        'message': '',
        'privacyCheck': False
    } %}

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <h2 class="text-center mb-4">Contact Me</h2>

                {% if success %}
                    <div class="alert alert-success">{{ success }}</div>
                {% elif error %}
                    <div class="alert alert-danger">{{ error }}</div>
                {% endif %}

                <form id="contactForm" method="POST" action="/submit">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" name="name" class="form-control" id="name" maxlength="50" required 
                            placeholder="Name" value="{{ form_data.get('name', '') }}">
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" name="email" class="form-control {% if errors['email'] %}is-invalid{% endif %}" 
                            id="email" required placeholder="Email" value="{{ form_data.get('email', '') }}">
                        {% if errors['email'] %}
                            <div class="error-popup">{{ errors['email'] }}</div>
                        {% endif %}
                    </div>
                    <div class="mb-3">
                        <label for="subject" class="form-label">Subject (max 100 chars)</label>
                        <input type="text" name="subject" class="form-control" id="subject" maxlength="100" 
                            placeholder="Subject (max 100 chars)" value="{{ form_data.get('subject', '') }}">
                    </div>
                    <div class="mb-3">
                        <label for="message" class="form-label">Message</label>
                        <textarea name="message" class="form-control" id="message" rows="5" maxlength="500" 
                            placeholder="Message (max 500 words)">{{ form_data.get('message', '') }}</textarea>
                    </div>
                    <div class="captcha-container">
                        <div class="h-captcha" data-sitekey="{{ sitekey }}"></div>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" name="privacyCheck" class="form-check-input" id="privacyCheck" 
                            required {% if form_data.get('privacyCheck') %}checked{% endif %}>
                        <label class="form-check-label" for="privacyCheck">I agree to the privacy policy</label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Submit</button>
                </form>

                <div class="privacy-disclaimer mt-3">
                    By submitting this form, you acknowledge that the information provided will be securely 
                    stored in our database for the sole purpose of facilitating communication. Your email 
                    address will undergo partial masking (e.g., exa****@d***.com) to protect your identity, 
                    and all data will be encrypted using industry-standard security protocols. We commit 
                    to compliance with GDPR and CCPA regulations, ensuring your right to access, modify, 
                    or request deletion of your information at any time. For security monitoring, IP 
                    addresses may be temporarily logged but never associated with personal data. No 
                    third-party sharing or commercial use of your information will occur without 
                    explicit consent.
                </div>
            </div>
        </div>
    </div>

    <!-- Required for hCaptcha to render -->
    <script src="https://js.hcaptcha.com/1/api.js?hl=en" async defer></script>

</body>
</html>
